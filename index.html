<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Cucumber-chef : Framework for test-driven infrastructure development" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Cucumber-chef</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/Atalanta/cucumber-chef">View on GitHub</a>

          <h1 id="project_title">Cucumber-chef</h1>
          <h2 id="project_tagline">Framework for test-driven infrastructure development</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/Atalanta/cucumber-chef/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/Atalanta/cucumber-chef/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <p>Cucumber-chef is a library of tools to enable the emerging discipline of infrastructure as code to practice test driven development.  It provides a testing platform within which Cucumber tests can be run which provision virtual machines, configure them by applying the appropriate Chef roles to them, and then run acceptance and integration tests against the environment.</p>

<h2>Overview</h2>

<p>Cucumber-chef begins with a very simple premise.  If we are framing our infrastructure as code - if we're writing cookbooks, recipes and other pieces of automation in a high level programming language, such as Ruby, then it makes sense to follow the current wisdom across the software development world to maximise the quality, maintainability and reusability of our code, providing maximum chance that we'll deliver value with it.  One area which has been shown to have a very positive effect is the practive of 'test-driven' development.  In this paradigm, the developer begins by writing a test that captures the intended behaviour of the code they are going to write.  This test will start out by failing.  The developer then writes code to make the test pass, and iterates thereafter.</p>

<p>Cucumber-chef provides a framework to make it easier to do test-driven development for infrastructure.  It does this by providing a test infrastructure, which we call the "test lab", within which a number of different scenarios can be set up, and against which Cucumber features can we run.  From the outset, Cucumber-chef's design was to provide a fast, lightweight and cheap way to fire up virtual machines for testing.  At present this is achieved using Linux Containers on Amazon EC2.  Supporting alternative provisioning backends is planned, which will allow the user to opt to test using local machines, alternative cloud providers, and ultimatey alternative virtualization technologies.</p>

<p>For node convergence, Cucumber-Chef uses the open-source Chef server.  It can be configured to use Hosted Chef or Private Chef.  Supoprt for Chef-solo will be included in a future relase.</p>

<p>As you might have guessed from the name, we're going to write high level acceptance tests using Cucumber.  Cucumber-Chef provides step definitions and helper methods to make it easy to provision and manage machines with Chef, and then build end-to-end tests.</p>

<h2>Getting Started</h2>

<p><em>LISTEN UP</em></p>

<p>Here's the headline:</p>

<p>With a /single command/ Cucumber-Chef will provision a machine, set up an open source Chef server, bootstrap it to support the creation of Linux containers, set up an environment from which to run tests, and automatically configure your system to use it.</p>

<p>This means getting started with Cucumber-Chef is a simple, three step process.</p>

<ol>
<li>Install Cucumber-Chef</li>
<li>Run <code>cucumber-chef init</code> to configure Cucumber-Chef.</li>
<li>Run <code>cucumber-chef setup</code> to build your test lab.</li>
</ol><h3>Installing Cucumber-Chef</h3>

<p>Cucumber-Chef is distributed as a RubyGem.  To install it you have two options - stable or development.</p>

<h4>Installing the stable version</h4>

<p>Simply install from RubyGems:</p>

<pre><code>$ gem install cucumber-chef
</code></pre>

<p>Depending on your local setup (ie whether you're using RVM or rbenv, or distribution-provided Ruby), you may need to run this with superuser privileges.</p>

<h4>Installing the development version</h4>

<p>If you want to try a development version, simply clone this repo, and build the gem yourself:</p>

<pre><code>$ git clone git://github.com/Atalanta/cucumber-chef -b BRANCH
$ cd cucumber-chef
$ bundle
$ rake build
$ gem install pkg/cucumber-chef-VERSION.gem
</code></pre>

<p>Again, depending on your local setup (ie whether you're using RVM or rbenv, or distribution-provided Ruby), you may need to run parts of this process with superuser privileges.</p>

<h3>Running <code>cucumber-chef init</code>
</h3>

<p>Cucumber-Chef ships with an initialization task, which will interactively generate configuration file.  This requires you to have, and know your Amazon Web Services credntials.  On completion of the interactive configuration, it will provision a machine on EC2, and set up the entire infrastructure, using Chef.</p>

<p>Cucumber-Chef doesn't demand where you keep your configuration file.  By default, the config will be created in <code>~/.cucumber-chef</code>, but this can be overridden.  Cucumber-Chef is clever enough to find your config, so it's all cool.</p>

<p>The two obvious places to keep this config, are in the top level of your Chef repository, or in a dedicated Cucumber-Chef repository, but you're free to do whatever works for you.</p>

<p>You can view and verify the current config at any time by running <code>cucumber-chef displayconfig</code>.  If Cucumber-Chef thinks your config is incorrect, or incomplete, it'll tell you.</p>

<h2>Using Cucumber-Chef</h2>

<p>Once installed, you can run <code>cucumber-chef</code> on the command line to get an overview of the tasks it can carry out.</p>

<pre><code>$ cucumber-chef
Tasks:
  cucumber-chef create &lt;project&gt;                   # Create a project template for testing an infrastructure.
  cucumber-chef diagnose &lt;container&gt;               # Provide diagnostics from the chef-client on the specified container.
  cucumber-chef displayconfig                      # Display the current cucumber-chef config.
  cucumber-chef help [TASK]                        # Describe available tasks or one specific task
  cucumber-chef info                               # Display information about the current test lab.
  cucumber-chef init                               # Initalize cucumber-chef configuration
  cucumber-chef setup                              # Setup cucumber-chef test lab in Amazon EC2
  cucumber-chef ssh [container]                    # SSH to cucumber-chef test lab or [container] if specified.
  cucumber-chef teardown                           # Teardown cucumber-chef test lab in Amazon EC2
  cucumber-chef test &lt;project&gt; [cucumber-options]  # Test a project using the cucumber-chef test suite.
</code></pre>

<p>After tunning set up, which takes about 15 minutes, you'll have a fully funtioning platform available for you to use.  Let's just quickly review what that means.  You will have an EC2 machine, fully managed by Chef, and providing the following:</p>

<ul>
<li>The ability to provision LXC containers</li>
<li>The ability to run tests against LXC containers</li>
<li>A dedicated environment for certain kinds of testing scenarios</li>
</ul><p>The next stage is to set up a project.  A project is simply a directory structure for containing your cucumber features and steps, already set up with an appropriate environment to make use of the step definitions provided with Cucumber-Chef.  Cucumber-chef provides a task which will create a the directory for you, and populate it with a README and an example feature and steps.  These represent futher documentation, and provide a model and steps to get you up and running with your testing as quickly as possible.</p>

<pre><code>$ cd /path/to/chef-repo
$ cucumber-chef create myproject
</code></pre>

<p>This will create a directory, cucumber-chef, and a subdirectory, <code>myproject</code>.</p>

<pre><code>└── myproject
    ├── README
    └── features
        ├── myproject.feature
        ├── step_definitions
        │   └── myproject_steps.rb
        └── support
            └── env.rb
</code></pre>

<h2>Writing Tests</h2>

<p>Once you've got your test lab set up, and you've generated a project, it's time to crack on with writing a test.  The basic idea is this:</p>

<ol>
<li>An infrastructure requirement is established</li>
<li>Write a cucumber feature that expresses the required behaviour of the infrastructure requirement</li>
<li>Write steps that will build this infrastructure environment on the test lab, using the step definitions provided - these include the ability to create a container, apply roles to it, and destroy it again.</li>
<li>Write cookbooks and recipes and supporting code to make the test pass</li>
</ol><h3>Container Details</h3>

<p>All containers operate off a bridged interface on the test-lab.  All outbound, non-local traffic from the LXC containers are NAT'd through the test-lab and off to the outside world.  This bridged interface on the test-lab is configured as follows:</p>

<pre><code>CIDR: 192.168.0.0/16
IP Address: 192.168.255.254
Netmask: 255.255.255.0
Broadcast: 192.168.255.255
</code></pre>

<p>You are free to use any IP in this /24, with the exception of the test-lab itself, which is at <code>192.168.255.254</code>.</p>

<h3>Built In Test Steps</h3>

<h4>Provisioning</h4>

<p>We provide several built in steps to help you with provisioning.  It is suggested you build a <code>Background</code> section for your features so these are not repeated with each scenario.  This example <code>Background</code> section does the following:</p>

<ul>
<li>Sets up a server called <code>devopserver</code>.</li>
<li>Makes the server persistent (it will remain up after the test finishes, which is the default behaviour).</li>
<li>Assigns it an IP address on the test lab network (this can be omitted for an auto-assigned IP).</li>
<li>Tells Cucumber-Chef to provision the server.</li>
<li>Adds the <code>chef-client::service</code> recipe in to the chef-client's run list.</li>
<li>Executes <code>chef-client</code> with the generated run list.</li>
<li>Starts an SSH session to the server so you can execute commands and test the output of those commands in the scenarios.</li>
</ul><p>Here is the <code>Background</code> section as you might write it in a feature:</p>

<pre><code>  Background:
    * I have a server called devopserver
    * devopserver is persistent
    * devopserver has an IP address of 192.168.10.10
    * devopserver has been provisioned
    * the chef-client::service recipe has been added to the devopserver run list
    * the chef-client has been run on devopserver
    * I have no public keys set
    * I ssh to devopserver with the following credentials:
      | username | password |
      | root     | root     |
</code></pre>

<p>To get a persistent server with an auto-assigned IP address you could write something like this:</p>

<pre><code>  Background:
    * I have a server called devopserver
    * devopserver has been provisioned
    * the chef-client::service recipe has been added to the devopserver run list
    * the chef-client has been run on devopserver
    * I have no public keys set
    * I ssh to devopserver with the following credentials:
      | username | password |
      | root     | root     |
</code></pre>

<p>You can add roles to the run list by writing:</p>

<pre><code>    * the chef-client role has been added to the devopserver run list
</code></pre>

<p>Here's an example <code>Scenario</code> section you might have to test if the chef-client is actually running as a daemon:</p>

<pre><code>  Scenario: Chef-Client is running as a daemon
    When I run "ps aux | grep [c]hef-client"
      Then I should see "chef-client" in the output
      And I should see "-d" in the output
      And I should see "-i 1800" in the output
      And I should see "-s 20" in the output
</code></pre>

<p>See the section below label <em>Example Test Run</em> for more examples.</p>

<h5>List of Provisioning Steps</h5>

<p>Create a server profile:</p>

<pre><code>I have a server called (server)
</code></pre>

<p>Set a (server) to persist or not:</p>

<pre><code>(server) is (persistent|non-persistent)
</code></pre>

<p>Assign (server) a specific IP address (must be on the test lab network segment):</p>

<pre><code>(server) has an IP address of (ip)
</code></pre>

<p>Assign (server) a specific MAC address:</p>

<pre><code>(server) has a MAC address of (mac)
</code></pre>

<p>Initiate the provision of a (server):</p>

<pre><code>(server) has been provisioned
</code></pre>

<p>Add a role to the chef-client run list:</p>

<pre><code>the (role) role has been added to the (server) run list
</code></pre>

<p>Add a recipe to the chef-client run list:</p>

<pre><code>the (recipe) recipe has been added to the (server) run list
</code></pre>

<p>Run the chef-client:</p>

<pre><code>the chef-client has been run on (server)
</code></pre>

<h4>SSH Steps</h4>

<p>Here is how you might setup and initate an SSH session using password authentication to a server named <code>devopserver</code>:</p>

<pre><code>    * I have no public keys set
    * I ssh to devopserver with the following credentials:
      | username | password |
      | root     | root     |
</code></pre>

<h5>List of SSH Steps</h5>

<p>Sets the authentication method to password:</p>

<pre><code>I have no public keys set
</code></pre>

<p>Start an SSH session to the server (server):</p>

<pre><code>I ssh to (server) with the following credentials:
  | username | password |
  | root     | root     |
</code></pre>

<p>Executes (command) over the previously established SSH session on the server (server):</p>

<pre><code>I run "(command)"
</code></pre>

<p>Check (command) output for an (expected) or (not-expected) string:</p>

<pre><code>I should see "(expected)" in the output
I should not see "(not-expected)" in the output
</code></pre>

<p>Check (command) output for existance of or lack of (server) settings:</p>

<pre><code>I should see the (ip|mac) of (server) in the output
I should not see the (ip|mac) of (server) in the output
</code></pre>

<h4>Cucumber Before Hook Centric Helpers</h4>

<ul>
<li><code>chef_set_client_config(config={})</code></li>
</ul><p>This method configures the chef-client's <code>client.rb</code> file.  Currently you can specify <code>:orgname</code>, <code>:log_level</code>, <code>:log_location</code>, <code>:chef_server_url</code> and <code>:validation_client_name</code>.  See your <code>env.rb</code> file if you need to change this to point it at a Hosted Chef Server or need to modify any of these values.</p>

<h5>Examples</h5>

<pre><code># for Opscode Hosted chef-server use this:
#chef_set_client_config(:orgname =&gt; "cucumber-chef")

# for Opscode OS chef-server on the Cucumber-Chef test lab use this:
chef_set_client_config(:chef_server_url =&gt; "http://192.168.255.254:4000",
                       :validation_client_name =&gt; "chef-validator")
</code></pre>

<h2>Running Tests</h2>

<p>You can write the tests and Chef code wherever you like.  We're assuming you prefer working on your local machine, and checking into version control.  But we don't really care.  When it's time to run tests, Cucumber-Chef provides a task which handles this:</p>

<pre><code>$ cucumber-chef test myproject
</code></pre>

<p>You can now pass in options for cucumber or even setup profiles via <code>cucumber.yml</code>.  Any command-line options specified after the project name will be passed on to cucumber.  For example:</p>

<pre><code>$ cucumber-chef test myproject --tags @wip -c -v -b
</code></pre>

<p>To take advantage of cucumber profiles, create a <code>cucumber.yml</code> configuration file in your <code>.cucumber-chef</code> directory off your chef-repo.  In this file you can take full advantage of the Cucumber profiles as definied on their wiki, <a href="https://github.com/cucumber/cucumber/wiki/cucumber.yml">https://github.com/cucumber/cucumber/wiki/cucumber.yml</a>.</p>

<pre><code>└── .cucumber-chef/
    └── cucumber.yml
</code></pre>

<p>Here is an example <code>cucumber.yml</code> which turns on colored output, verbosity and full backtraces for all test runs:</p>

<pre><code>---
default: -c -v -b
</code></pre>

<p>Running the test task will upload your current project to the test lab, and run the tests, reporting the results back to the screen. Cucumber-chef also provides an upload task, so you can push the current project to the test lab, and then connect to test lab yourself to run tests in a more granular way.  To do this, you need to know the IP of the test lab.  You can find this out by running:</p>

<pre><code>$ cucumber-chef info
</code></pre>

<p>At present, Cucumber-Chef only allows one test lab per AWS account.  In practice, this has not been a constraint.  LXC is incredibly lightweight, and a large number of containers can be provisioned on even a small EC2 instance.</p>

<h3>When Things Go Oh So Wrong</h3>

<p>We have put in a few tasks to help you diagnose any issues you may come across with the test lab, containers or your cookbooks and recipes.  There are two main tasks available to help you with this: <code>ssh</code> and <code>diagnose</code>.</p>

<ul>
<li><code>ssh</code></li>
</ul><p>This command provides you with a rapid way to connect to either your test lab or containers.  Think <code>vagrant ssh</code>; we took a queue from their wonderful gem and realized we want our gem to provide the same sort of functionality.  The main difference between our <code>ssh</code> task and the way Vagrant's task works is that we generate a fresh ssh key pair whenever a test lab is setup; so you can rest assured no one else has a copy of the credientials.  You also do not have to worry about generating or specifying your own key pair to override a default key pair as is the case with Vagrant if you do not want to use the one shipped with Vagrant.</p>

<pre><code>$ cucumber-chef ssh
Attempting SSH connection to cucumber-chef 'test lab'...
      _____                           _                _____ _           __
     / ____|                         | |              / ____| |         / _|
    | |    _   _  ___ _   _ _ __ ___ | |__   ___ _ __| |    | |__   ___| |_
    | |   | | | |/ __| | | | '_ ` _ \| '_ \ / _ \ '__| |    | '_ \ / _ \  _|
    | |___| |_| | (__| |_| | | | | | | |_) |  __/ |  | |____| | | |  __/ |
     \_____\__,_|\___|\__,_|_| |_| |_|_.__/ \___|_|   \_____|_| |_|\___|_|


    Welcome to the Cucumber Chef Test Lab v2.0.0.rc1

Last login: Mon Jun  4 07:56:40 2012 from [REDACTED]
ubuntu@cucumber-chef:~$
</code></pre>

<p>Keep in mind with Amazon's EC2 the base <code>ubuntu</code> user is already in the sudoers file; so you can <code>sudo su -</code> without needing the password.</p>

<pre><code>ubuntu@cucumber-chef:~$ sudo su -
root@cucumber-chef:~#
</code></pre>

<p>You can also specify a container name to SSH directly into that container.  For now you are always logged in as <code>root</code> when you SSH to a container.</p>

<pre><code>$ cucumber-chef ssh devopserver
Attempting SSH connection to cucumber-chef container 'devopserver'...
      _____                           _                _____ _           __
     / ____|                         | |              / ____| |         / _|
    | |    _   _  ___ _   _ _ __ ___ | |__   ___ _ __| |    | |__   ___| |_
    | |   | | | |/ __| | | | '_ ` _ \| '_ \ / _ \ '__| |    | '_ \ / _ \  _|
    | |___| |_| | (__| |_| | | | | | | |_) |  __/ |  | |____| | | |  __/ |
     \_____\__,_|\___|\__,_|_| |_| |_|_.__/ \___|_|   \_____|_| |_|\___|_|


    Welcome to the Cucumber Chef Test Lab v2.0.0.rc1

    You are now logged in to the LXC 'devopserver'

root@devopserver:~#
</code></pre>

<ul>
<li><code>diagnose</code></li>
</ul><p>This command provides you with a rapid way to get to the chef-client logs without needing to SSH into a container.  There are a few basic options with this task, let's take a look at them.</p>

<pre><code>$ cucumber-chef help diagnose
Usage:
  cucumber-chef diagnose &lt;container&gt;

Options:
  -n, [--lines=N]  # output the last N lines of the chef-client 'chef.log'
                   # Default: 1
  -s, [--strace]   # output the chef-client 'chef-stacktrace.out'
                   # Default: true
  -l, [--log]      # output the chef-client 'chef.log'
                   # Default: true

Provide diagnostics from the chef-client on the specified container.
</code></pre>

<p>With the default options in effect, this task will output the <code>chef-stacktrace.out</code> file along with the last line of the <code>chef.log</code> file.  You can of course request as many lines as you desire from the <code>chef.log</code> file.  For example to look at the last 1000 lines of only the <code>chef.log</code> file you would likely run the task as follows.</p>

<pre><code>$ cucumber-chef diagnose devopserver --no-strace -n 1000
</code></pre>

<p>Maybe you only want to view the <code>chef-stacktrace.out</code> file?</p>

<pre><code>$ cucumber-chef diagnose devopserver --no-log
</code></pre>

<p>Maybe you want to run it with the default options in play; you would likely get some output as follows.</p>

<pre><code>$ cucumber-chef diagnose devopserver
Attempting to collect diagnostic information on cucumber-chef container 'sysopserver'...
----------------------------------------------------------------------------
chef-stacktrace.out:
----------------------------------------------------------------------------
Generated at 2012-06-04 08:30:20 +0000
Net::HTTPServerException: 412 "Precondition Failed"
/opt/opscode/embedded/lib/ruby/1.9.1/net/http.rb:2303:in `error!'
/opt/opscode/embedded/lib/ruby/gems/1.9.1/gems/chef-0.10.10/lib/chef/rest.rb:264:in `block in api_request'
/opt/opscode/embedded/lib/ruby/gems/1.9.1/gems/chef-0.10.10/lib/chef/rest.rb:328:in `retriable_rest_request'
/opt/opscode/embedded/lib/ruby/gems/1.9.1/gems/chef-0.10.10/lib/chef/rest.rb:240:in `api_request'
/opt/opscode/embedded/lib/ruby/gems/1.9.1/gems/chef-0.10.10/lib/chef/rest.rb:139:in `post_rest'
/opt/opscode/embedded/lib/ruby/gems/1.9.1/gems/chef-0.10.10/lib/chef/client.rb:313:in `sync_cookbooks'
/opt/opscode/embedded/lib/ruby/gems/1.9.1/gems/chef-0.10.10/lib/chef/client.rb:194:in `setup_run_context'
/opt/opscode/embedded/lib/ruby/gems/1.9.1/gems/chef-0.10.10/lib/chef/client.rb:162:in `run'
/opt/opscode/embedded/lib/ruby/gems/1.9.1/gems/chef-0.10.10/lib/chef/application/client.rb:254:in `block in run_application'
/opt/opscode/embedded/lib/ruby/gems/1.9.1/gems/chef-0.10.10/lib/chef/application/client.rb:241:in `loop'
/opt/opscode/embedded/lib/ruby/gems/1.9.1/gems/chef-0.10.10/lib/chef/application/client.rb:241:in `run_application'
/opt/opscode/embedded/lib/ruby/gems/1.9.1/gems/chef-0.10.10/lib/chef/application.rb:70:in `run'
/opt/opscode/embedded/lib/ruby/gems/1.9.1/gems/chef-0.10.10/bin/chef-client:26:in `&lt;top (required)&gt;'
/usr/bin/chef-client:19:in `load'
/usr/bin/chef-client:19:in `&lt;main&gt;'
----------------------------------------------------------------------------
chef.log:
----------------------------------------------------------------------------
[Mon, 04 Jun 2012 08:30:20 +0000] FATAL: Net::HTTPServerException: 412 "Precondition Failed"
</code></pre>

<h3>Example Test Run</h3>

<p>Here is an example of using Cucumber-Chef to do a basic test.  In this test we will provision a server called <code>devopserver</code> and apply the <code>chef-client::service</code> recipe from the <code>chef-client</code> community cookbook.  This example assumes you have your test lab provisioned and up and running.  First things first, make sure you've downloaded the <code>chef-client</code> community cookbook and placed it in your chef-repo.</p>

<p>Now upload the <code>chef-client</code> community cookbook to your Cucumber-Chef test lab.</p>

<pre><code>$ cc-knife cookbook upload chef-client
Uploading chef-client             [1.1.2]
Uploaded 1 cookbook.
</code></pre>

<p>Next create your <code>devopserver</code> feature.</p>

<pre><code>$ cucumber-chef create devopserver
</code></pre>

<p>Here is the feature we'll be using.  This feature has some extra scenarios to illustrate how you might go about testing other parts of a system.  Go into the features directory of your chef-repo and replace the contents of the <code>devopserver.feature</code> file with the text below.</p>

<pre><code>@devop
Feature: Do test driven infrastructure with Cucumber-Chef
  In order to learn how to develop test driven infrastructure
  As an infrastructure developer
  I want to better understand how to use Cucumber-Chef

  Background:
    * I have a server called devopserver
    * devopserver is persistent
    * devopserver has an IP address of 192.168.10.10
    * devopserver has been provisioned
    * the chef-client::service recipe has been added to the devopserver run list
    * the chef-client has been run on devopserver
    * I have no public keys set
    * I ssh to devopserver with the following credentials:
      | username | password |
      | root     | root     |

  Scenario: Can connect to the provisioned server via SSH password authentication
    When I run "hostname"
    Then I should see "devopserver" in the output

  Scenario: Default root shell is bash
    When I run "echo $SHELL"
    Then I should see "bash" in the output

  Scenario: Default gateway and resolver are using Cucumber-Chef Test Lab
    When I run "route -n | grep 'UG'"
      Then I should see "192.168.255.254" in the output
    When I run "cat /etc/resolv.conf"
      Then I should see "192.168.255.254" in the output
      And I should see "8.8.8.8" in the output
      And I should see "8.8.4.4" in the output

  Scenario: Primary interface is configured with my IP address and MAC address
    When I run "ifconfig eth0"
      Then I should see the IP of devopserver in the output
      And I should see the MAC of devopserver in the output

  Scenario: Local interface is not configured with my IP address or MAC address
    When I run "ifconfig lo"
      Then I should see "127.0.0.1" in the output
      And I should not see the IP of devopserver in the output
      And I should not see the MAC of devopserver in the output

  Scenario: Chef-Client is running as a daemon
    When I run "ps aux | grep [c]hef-client"
      Then I should see "chef-client" in the output
      And I should see "-d" in the output
      And I should see "-i 1800" in the output
      And I should see "-s 20" in the output
</code></pre>

<p>Now we're going to execute the test.  I've tagged the feature with <code>@devop</code>, so be sure to pass that to the test runner so Cucumber knows to only run tests tagged with that.</p>

<pre><code>$ cucumber-chef test --tags @devop
Using features directory: /home/[REDACTED]/code/chef-repo/features
Cucumber-Chef Test Runner Initalized!
Cleaning up any previous test runs...done.
Uploading files required for this test run...done.
Executing Cucumber-Chef Test Runner
Using the default profile...
Code:
  * /home/ubuntu/features/support/env.rb
  * /home/ubuntu/features/step_definitions/devopserver_steps.rb

Features:
  * /home/ubuntu/features/devopserver.feature
Parsing feature files took 0m0.075s

@devop
Feature: Do test driven infrastructure with Cucumber-Chef
  In order to learn how to develop test driven infrastructure
  As an infrastructure developer
  I want to better understand how to use Cucumber-Chef

  Background:                                                                    # /home/ubuntu/features/devopserver.feature:7
    * all servers are being destroyed
    * I have a server called devopserver                                         # cucumber-chef-2.0.0.rc1/lib/cucumber/chef/steps/provision_steps.rb:1
    * devopserver is persistent                                                  # cucumber-chef-2.0.0.rc1/lib/cucumber/chef/steps/provision_steps.rb:5
    * devopserver has an IP address of 192.168.10.10                             # cucumber-chef-2.0.0.rc1/lib/cucumber/chef/steps/provision_steps.rb:9
    * devopserver is being provisioned
    * devopserver has been provisioned                                           # cucumber-chef-2.0.0.rc1/lib/cucumber/chef/steps/provision_steps.rb:17
    * the chef-client::service recipe has been added to the devopserver run list # cucumber-chef-2.0.0.rc1/lib/cucumber/chef/steps/provision_steps.rb:25
    * the chef-client has been run on devopserver                                # cucumber-chef-2.0.0.rc1/lib/cucumber/chef/steps/provision_steps.rb:29
    * I have no public keys set                                                  # cucumber-chef-2.0.0.rc1/lib/cucumber/chef/steps/ssh_steps.rb:1
    * I ssh to devopserver with the following credentials:                       # cucumber-chef-2.0.0.rc1/lib/cucumber/chef/steps/ssh_steps.rb:56
      | username | password |
      | root     | root     |

  Scenario: Can connect to the provisioned server via SSH password authentication # /home/ubuntu/features/devopserver.feature:19
    When I run "hostname"                                                         # cucumber-chef-2.0.0.rc1/lib/cucumber/chef/steps/ssh_steps.rb:76
    Then I should see "devopserver" in the output                                 # cucumber-chef-2.0.0.rc1/lib/cucumber/chef/steps/ssh_steps.rb:80

  Scenario: Default root shell is bash                                           # /home/ubuntu/features/devopserver.feature:23
    When I run "echo $SHELL"                                                     # cucumber-chef-2.0.0.rc1/lib/cucumber/chef/steps/ssh_steps.rb:76
    Then I should see "bash" in the output                                       # cucumber-chef-2.0.0.rc1/lib/cucumber/chef/steps/ssh_steps.rb:80

  Scenario: Default gateway and resolver are using Cucumber-Chef Test Lab        # /home/ubuntu/features/devopserver.feature:27
    When I run "route -n | grep 'UG'"                                            # cucumber-chef-2.0.0.rc1/lib/cucumber/chef/steps/ssh_steps.rb:76
    Then I should see "192.168.255.254" in the output                            # cucumber-chef-2.0.0.rc1/lib/cucumber/chef/steps/ssh_steps.rb:80
    When I run "cat /etc/resolv.conf"                                            # cucumber-chef-2.0.0.rc1/lib/cucumber/chef/steps/ssh_steps.rb:76
    Then I should see "192.168.255.254" in the output                            # cucumber-chef-2.0.0.rc1/lib/cucumber/chef/steps/ssh_steps.rb:80
    And I should see "8.8.8.8" in the output                                     # cucumber-chef-2.0.0.rc1/lib/cucumber/chef/steps/ssh_steps.rb:80
    And I should see "8.8.4.4" in the output                                     # cucumber-chef-2.0.0.rc1/lib/cucumber/chef/steps/ssh_steps.rb:80

  Scenario: Primary interface is configured with my IP address and MAC address   # /home/ubuntu/features/devopserver.feature:35
    When I run "ifconfig eth0"                                                   # cucumber-chef-2.0.0.rc1/lib/cucumber/chef/steps/ssh_steps.rb:76
    Then I should see the IP of devopserver in the output                        # cucumber-chef-2.0.0.rc1/lib/cucumber/chef/steps/ssh_steps.rb:88
    And I should see the MAC of devopserver in the output                        # cucumber-chef-2.0.0.rc1/lib/cucumber/chef/steps/ssh_steps.rb:88

  Scenario: Local interface is not configured with my IP address or MAC address  # /home/ubuntu/features/devopserver.feature:40
    When I run "ifconfig lo"                                                     # cucumber-chef-2.0.0.rc1/lib/cucumber/chef/steps/ssh_steps.rb:76
    Then I should see "127.0.0.1" in the output                                  # cucumber-chef-2.0.0.rc1/lib/cucumber/chef/steps/ssh_steps.rb:80
    And I should not see the IP of devopserver in the output                     # cucumber-chef-2.0.0.rc1/lib/cucumber/chef/steps/ssh_steps.rb:92
    And I should not see the MAC of devopserver in the output                    # cucumber-chef-2.0.0.rc1/lib/cucumber/chef/steps/ssh_steps.rb:92

  Scenario: Chef-Client is running as a daemon                                   # /home/ubuntu/features/devopserver.feature:46
    When I run "ps aux | grep [c]hef-client"                                     # cucumber-chef-2.0.0.rc1/lib/cucumber/chef/steps/ssh_steps.rb:76
    Then I should see "chef-client" in the output                                # cucumber-chef-2.0.0.rc1/lib/cucumber/chef/steps/ssh_steps.rb:80
    And I should see "-d" in the output                                          # cucumber-chef-2.0.0.rc1/lib/cucumber/chef/steps/ssh_steps.rb:80
    And I should see "-i 1800" in the output                                     # cucumber-chef-2.0.0.rc1/lib/cucumber/chef/steps/ssh_steps.rb:80
    And I should see "-s 20" in the output                                       # cucumber-chef-2.0.0.rc1/lib/cucumber/chef/steps/ssh_steps.rb:80

6 scenarios (6 passed)
70 steps (70 passed)
2m8.459s
</code></pre>

<p>If all goes well you should see output similar to what's above!  Enjoy and have fun!</p>

<h1>LINKS</h1>

<p>Source:</p>

<ul>
<li><a href="https://github.com/Atalanta/cucumber-chef">https://github.com/Atalanta/cucumber-chef</a></li>
</ul><p>Issues:</p>

<ul>
<li><a href="https://github.com/Atalanta/cucumber-chef/issues">https://github.com/Atalanta/cucumber-chef/issues</a></li>
</ul><p>Wiki:</p>

<ul>
<li><a href="https://github.com/Atalanta/cucumber-chef/wiki">https://github.com/Atalanta/cucumber-chef/wiki</a></li>
</ul><h1>LICENSE</h1>

<p>Cucumber-Chef - A test driven infrastructure system</p>

<ul>
<li>Author: Stephen Nelson-Smith <a href="mailto:stephen@atalanta-systems.com">stephen@atalanta-systems.com</a>
</li>
<li>Author: Zachary Patten <a href="mailto:zachary@jovelabs.com">zachary@jovelabs.com</a>
</li>
<li>Copyright: Copyright (c) 2011-2012 Cucumber-Chef</li>
<li>License: Apache License, Version 2.0</li>
</ul><p>Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at</p>

<pre><code>http://www.apache.org/licenses/LICENSE-2.0
</code></pre>

<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Cucumber-chef maintained by <a href="https://github.com/Atalanta">Atalanta</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
